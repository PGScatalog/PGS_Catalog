{% extends 'catalog/base.html' %}
{% load render_table from django_tables2 %}

{% block title %}{{ pgs_id }} / {{ score.trait_reported }} (Polygenic Score){% endblock %}

{% block content %}
    <nav aria-label="You are here:">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../">PGS Catalog</a></li>
        <li class="breadcrumb-item"><a href="../../browse/all/">Polygenic Scores</a></li>
        <li class="breadcrumb-item">{{ pgs_id }}</li>
      </ol>
    </nav>



    <div class="clearfix">
      <h2 class="float_left">Polygenic Score (PGS) ID: <b>{{score.id}}</b></h2>
      <div class="float_right">
        <a class="btn btn-pgs pgs_no_icon_link" href="{{ pgs_ftp_root }}/ScoringFiles_formatted/{{ score.id }}.txt.gz" download>
          <span class="icon icon-common" data-icon="&#xf019;"></span> <b>Download PGS</b><div class="btn-sub-text">Variants and weights data file</div>
        </a>
      </div>
    </div>
    <section>
      <div class="row">
        <div class="col">
          <h3>Score Details</h3>

          <table class="table table-bordered table_pgs_h">
            <tbody>
              <tr>
                <td>Name</td>
                <td><b>{{ score.name }}</b></td>
              </tr>
              <tr>
                <td>Original Genome Build</td>
                <td><b>{{ score.variants_genomebuild }}</b></td>
              </tr>
              <tr>
                <td>Number of Variants</td>
                <td><span class="badge badge-pill badge-pgs">{{ num_variants_pretty }}</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="col">
          <h3>Development Method</h3>
          <table class="table table-bordered table_pgs_h">
            <tbody>
              <tr>
                <td>Name</td>
                <td><b>{{ score.method_name }}</b></td>
              </tr>

                <tr>
                  <td>Parameters</td>

                  <td id="pgs_params">
                    {% if score.method_params %}
                      {{ score.method_params }}
                    {% else %}
                      NR
                    {% endif %}
                  </td>
                </tr>
              {% if score.variants_interactions > 0 %}
                <tr>
                  <td>Number of Variant Interaction Terms</td>
                  <td>{{ score.variants_interactions }}</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <h3>Predicted Trait</h3>
          <table class="table table-bordered table_pgs_h">
            <tbody>
              <tr>
                <td>Reported Trait</td>
                <td><b>{{ score.trait_reported }}</b></td>
              </tr>
              <tr>
                <td>Mapped Trait(s)</td>
                <td>
                    {% if efos|length == 1 %}
                      <a class="mr-2" href="../../trait/{{ efos.0.id }}"><b>{{ efos.0.label }}</b></a>
                      (<a href="https://www.ebi.ac.uk/efo/{{ efos.0.id }}">{{ efos.0.id }}</a>)
                    {% else %}
                      <ul class="mb-0">
                      {% for trait in efos  %}
                        <li>
                          <a class="mr-2" href="../../trait/{{ trait.id }}"><b>{{ trait.label }}</b></a>
                          (<a href="https://www.ebi.ac.uk/efo/{{ trait.id }}">{{ trait.id }}</a>)
                        </li>
                      {% endfor %}
                      </ul>
                    {% endif %}
                </td>
              </tr>
            {% if score.trait_additional != '' and score.trait_additional != None %}
              <tr>
                <td>Additional Trait Information</td>
                <td>{{ score.trait_additional }}</td>
              </tr>
            {% endif %}
            </tbody>
          </table>
        </div>

        <div class="col">
          <h3>Citation</h3>
          <table class="table table-bordered table_pgs_h">
            <tbody>
              <tr>
                <td>Publication</td>
                <td>{{ citation }}</td>
              </tr>
              <tr>
                <td>PGS Catalog Publication ID</td>
                <td><a href=../../publication/{{ score.publication.id }}>{{ score.publication.id }}</a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

        <h4>Contributing Samples</h4>
        {% if table_sample_variants or table_sample_training %}
            {% if table_sample_variants %}
                <h5>Source of Variant Associations (GWAS)</h5>
                {% render_table table_sample_variants %}
            {% endif %}
            {% if table_sample_training %}
                <h5>Score Development/Training</h5>
                {% render_table table_sample_training %}
            {% endif %}
        {% else %}
            No sample information available.
        {% endif %}
    </section>
        <h3>Performance Metrics</h3>
        <p>{{ performance_disclaimer|safe }}</p>
        {% render_table table_performance %}
        <h4>Evaluated Samples</h4>
        {% render_table table_performance_samples %}
    </section>
{% endblock %}
